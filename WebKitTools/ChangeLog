2007-04-18  Adam Roben  <aroben@apple.com>

        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree.sln: Added a
        Debug_Internal configuration.

2007-04-17  Steve Falkenburg  <sfalken@apple.com>

        Reviewed by Hyatt.
        
        Eliminate more ATL use (CComBSTR)

        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/DumpRenderTree.cpp:
        (dumpFrameScrollPosition):
        (compareHistoryItems):
        (dumpHistoryItem):
        (dump):
        (runTest):
        (initializePreferences):
        (main):
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/DumpRenderTree.vcproj:
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/EditingDelegate.cpp:
        (dumpPath):
        (EditingDelegate::webViewDidBeginEditing):
        (EditingDelegate::webViewDidChange):
        (EditingDelegate::webViewDidEndEditing):
        (EditingDelegate::webViewDidChangeTypingStyle):
        (EditingDelegate::webViewDidChangeSelection):
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/LayoutTestController.cpp:
        (queueLoadCallback):
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/WorkQueueItem.cpp:
        (LoadItem::invoke):
        (ScriptItem::invoke):

2007-04-16  Steve Falkenburg  <sfalken@apple.com>

        Reviewed by Adam.
        
        Eliminate some ATL use in our future open source tree.
        
        ATL headers are not included in any free download, so we'll need to
        remove all use of ATL from our open source for compatibility with
        Visual Studio Express.
        
        Replace CComPtr and CComQIPtr with COMPtr.

        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/DumpRenderTree.cpp:
        (dumpFrameScrollPosition):
        (compareHistoryItems):
        (dumpHistoryItem):
        (dumpBackForwardList):
        (dump):
        (runTest):
        (main):
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/EditingDelegate.cpp:
        (dumpPath):
        (dump):
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/EventSender.cpp:
        (mouseDownCallback):
        (doMouseUp):
        (doMouseMove):
        (keyDownCallback):
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/LayoutTestController.cpp:
        (setAcceptsEditingCallback):
        (clearBackForwardListCallback):
        (setTabKeyCyclesThroughElementsCallback):
        (queueLoadCallback):
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/WaitUntilDoneDelegate.cpp:
        (WaitUntilDoneDelegate::didCommitLoadForFrame):
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/WorkQueueItem.cpp:
        (LoadItem::invoke):
        (ReloadItem::invoke):
        (ScriptItem::invoke):
        (BackForwardItem::invoke):
        * DumpRenderTree/DumpRenderTree.vcproj/TestNetscapePlugin/TestNetscapePlugin.rc: Remove atlmfc header include

2007-04-14  Adam Roben  <aroben@apple.com>

        Reviewed by Steve.

        Added a Debug_Internal configuration to DRT to match WebKit/WebCore.
        Debug now compiles against release CoreGraphics.lib and pthreadVC2.lib.

        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/DumpRenderTree.vcproj:
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/debug.vsprops:
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/debug_internal.vsprops: Added.
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/release.vsprops:

2007-04-13  Anders Carlsson  <andersca@apple.com>

        Fix the release build too!

        * DumpRenderTree/DumpRenderTree.vcproj/TestNetscapePlugin/TestNetscapePlugin.vcproj:

2007-04-13  Anders Carlsson  <andersca@apple.com>

        Fix build.
        
        * DumpRenderTree/DumpRenderTree.vcproj/TestNetscapePlugin/TestNetscapePlugin.vcproj:
        #define snprintf to be _snprintf and dd two defines to disable warnings for strdup and _snprintf.

2007-04-03  Adam Roben  <aroben@apple.com>

        Reviewed by Anders.

        DRT part of fix for <rdar://problem/5103999> All dom/svg tests are
        failing due to extra/missing newlines

        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/DumpRenderTree.cpp:
        (dump): Call IDOMElementPrivate::innerText to match Mac DRT.

2007-04-03  Adam Roben  <aroben@apple.com>

        Rubberstamped by Adele.

        Make all layout tests paint to match Mac DRT. This fixes many tests in
        svg/hixie.

        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/DumpRenderTree.cpp:
        (dump): Always force a paint.

2007-04-02  Anders Carlsson  <andersca@apple.com>

        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree.sln:
        Add TestNetscapeObject project.

2007-04-02  Anders Carlsson  <andersca@apple.com>

        Reviewed by Adam.

        Add netscape test plugin VC project. Make DumpRenderTree look for the test plugin.
        
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/DumpRenderTree.cpp:
        (initialize):
        (initializePreferences):
        (main):
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/DumpRenderTree.vcproj:
        * DumpRenderTree/DumpRenderTree.vcproj/TestNetscapePlugin/TestNetscapePlugin.def: Added.
        * DumpRenderTree/DumpRenderTree.vcproj/TestNetscapePlugin/TestNetscapePlugin.rc: Added.
        * DumpRenderTree/DumpRenderTree.vcproj/TestNetscapePlugin/TestNetscapePlugin.vcproj: Added.
        * DumpRenderTree/DumpRenderTree.vcproj/TestNetscapePlugin/resource.h: Added.

        * DumpRenderTree/DumpRenderTree.vcproj/TestNetscapePlugin/main.c:
        Merge changes from the Open Source tree.        

2007-03-31  Adele Peterson  <adele@apple.com>

        Reviewed by Adam.

        A little cleanup from my last change.  Added a comment, and moved a JSStringRelease call to a better place.

        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/EventSender.cpp:
        (keyDownCallback):

2007-03-30  Adele Peterson  <adele@apple.com>

        Reviewed by Beth.

        Fix for  <rdar://problem/5079824> editing/deleting/delete-by-word-001 is failing

        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/EventSender.cpp: (keyDownCallback):
        Added hack to convert option-delete to ctrl-delete.  Also fixed this to correctly convert ascii
        codes to virtual key codes, which removes the need for the special conversion of '\n' to VK_RETURN.

2007-03-30  Anders Carlsson  <andersca@apple.com>

        Reviewed by Geoff.

        * DumpRenderTree/DumpRenderTree.vcproj/TestNetscapePlugin/main.c: 
        Add forked version.

2007-03-25  Adam Roben  <aroben@apple.com>

        Reviewed by Oliver.

        Fix <rdar://problem/5086934> DumpRenderTree doesn't support
        layoutTestController.queueLoad

        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/DumpRenderTree.cpp:
        (dump): Ported Mac code to check the MIME type before dumping.
        (runTest): Clear the work queue before each test.
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/DumpRenderTree.vcproj:
        Added new files.
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/LayoutTestController.cpp:
        (notifyDoneCallback): Only dump if the work queue is empty.
        (jsValueToCString): Added.
        (queueLoadCallback): Added.
        (queueReloadCallback): Added.
        (queueScriptCallback): Added.
        (queueBackNavigationCallback): Added.
        (queueForwardNavigationCallback): Added.
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/WaitUntilDoneDelegate.cpp:
        (WaitUntilDoneDelegate::processWork): Added.
        (processWorkTimer): Added.
        (WaitUntilDoneDelegate::locationChangeDone): Changed to match Mac.
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/WaitUntilDoneDelegate.h:
        Added declaration.
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/WorkQueue.cpp: Added.
        (WorkQueue::shared):
        (WorkQueue::WorkQueue):
        (WorkQueue::queue):
        (WorkQueue::dequeue):
        (WorkQueue::count):
        (WorkQueue::clear):
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/WorkQueue.h: Added.
        (WorkQueue::setFrozen):
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/WorkQueueItem.cpp: Added.
        (LoadItem::invoke):
        (ReloadItem::invoke):
        (ScriptItem::invoke):
        (BackForwardItem::invoke):
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/WorkQueueItem.h: Added.
        (LoadItem::LoadItem):
        (LoadItem::url):
        (LoadItem::target):
        (ScriptItem::ScriptItem):
        (ScriptItem::script):
        (BackItem::BackItem):
        (ForwardItem::ForwardItem):

2007-03-24  Adam Roben  <aroben@apple.com>

        Reviewed by Oliver.

        Fix <rdar://problem/5086932> DumpRenderTree doesn't support
        layoutTestController.dumpBackForwardList

        Unfortunately the ported code is mostly untested due to
        <rdar://problem/5086934>.

        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/DumpRenderTree.cpp:
        (compareHistoryItems): Ported from Mac.
        (dumpHistoryItem): Ditto.
        (dumpBackForwardList): Ditto.
        (dump): Dump the back-forward list if requested.
        (runTest): Initialize new globals.
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/DumpRenderTree.h:
        Added extern declaration.
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/LayoutTestController.cpp:
        (dumpBackForwardListCallback): Implemented.

2007-03-23  Adam Roben  <aroben@apple.com>

        Reviewed by Oliver.

        Fix <rdar://problem/5085170> DumpRenderTree doesn't print frame scroll offsets

        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/DumpRenderTree.cpp:
        (dumpFrameScrollPosition): Ported from Mac.
        (dump): Added call to dumpFrameScrollPosition.
        (runTest): Initialize new global.
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/DumpRenderTree.h:
        Added extern declaration.
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/LayoutTestController.cpp:
        (dumpChildFrameScrollPositionsCallback): Implemented.

2007-03-22  Adam Roben  <aroben@apple.com>

        Reviewed by Adele.

        Implemented layoutTestController.dumpTitleChanges.

        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/DumpRenderTree.cpp:
        (runTest): Initialize new global.
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/DumpRenderTree.h:
        Added extern declaration.
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/LayoutTestController.cpp:
        (dumpTitleChangesCallback): Implemented.
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/WaitUntilDoneDelegate.cpp:
        (WaitUntilDoneDelegate::didReceiveTitle): Implemented.

2007-03-22  Adam Roben  <aroben@apple.com>

        Rubberstamped by Geoff.

        Removed eventSender.mouseClick now that it isn't used.

        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/EventSender.cpp:

2007-03-21  Adam Roben  <aroben@apple.com>

        Reviewed by Hyatt.

        Force SVG tests to paint to match the Mac results.

        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/DumpRenderTree.cpp:
        (dump): Force a paint if we're running an SVG test.

2007-03-21  Adam Roben  <aroben@apple.com>

        Reviewed by Oliver.

        Make W3C SVG tests render at the correct dimensions.

        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/DumpRenderTree.cpp:
        (dump): Resize the WebView if we're running a W3C SVG test.
        (runTest): Save the current test filename.

2007-03-21  Adele Peterson  <adele@apple.com>

        Reviewed by Adam.
        
        Fix for <rdar://problem/5076213> fast/forms/input-text-enter.html fails
        
        Call updateActiveState on the WebView in didCommitLoadForFrame.  This is required so that nodes can be properly focused in the document.
        
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/WaitUntilDoneDelegate.cpp: (WaitUntilDoneDelegate::didCommitLoadForFrame):
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/WaitUntilDoneDelegate.h:

2007-03-20  Adam Roben  <aroben@apple.com>

        Reviewed by Brady.

        Always use CCom* smart pointers when possible to avoid memory management issues.

        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/DumpRenderTree.cpp:
        (initialize): Changed _T() to TEXT().
        (dump):
        (runTest):
        (initializePreferences):
        (main):
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/EditingDelegate.cpp:
        (dumpPath):
        (dump):
        (EditingDelegate::webViewDidBeginEditing):
        (EditingDelegate::webViewDidChange):
        (EditingDelegate::webViewDidEndEditing):
        (EditingDelegate::webViewDidChangeTypingStyle):
        (EditingDelegate::webViewDidChangeSelection):
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/EventSender.cpp:
        (mouseDownCallback):
        (doMouseUp):
        (mouseClickCallback):
        (doMouseMove):
        (keyDownCallback):
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/LayoutTestController.cpp:
        (setAcceptsEditingCallback):
        (setTabKeyCyclesThroughElementsCallback):

2007-03-20  Maciej Stachowiak  <mjs@apple.com>

        Reviewed by Geoff and Adam.
        
        - fixed some bugs in --threaded fond in the course of testing.

        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/DumpRenderTree.cpp:
        (runJavaScriptThread): Be smarter about thread dictionary.
        (startJavaScriptThreads): Ditto.
        (stopJavaScriptThreads): Ditto.
        (main): Account for --threaded command-line argument better.

2007-03-20  Adam Roben  <aroben@apple.com>

        Reviewed by Hyatt.

        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/DumpRenderTree.cpp:
        (initialize): Install Helevetica Neue.

2007-03-20  Adam Roben  <aroben@apple.com>

        Release build fix.

        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/DumpRenderTree.vcproj:
        Removed bogus extra linker options.

2007-03-20  Adele Peterson  <adele@apple.com>

        Reviewed by Adam.

        Explicitly pass VK_RETURN when using keyDown for "\n".
        
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/EventSender.cpp:
        (keyDownCallback):

2007-03-20  Adam Roben  <aroben@apple.com>

        Release build fix.

        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/DumpRenderTree.vcproj: Set libpath.

2007-03-20  Adam Roben  <aroben@apple.com>

        Reviewed by Oliver.

        Implemented layoutTestController.setTabKeyCyclesThroughElements() to
        fix fast/events/keypress-insert-tab.html.

        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/EventSender.cpp:
        (keyDownCallback): Removed unnecessary string comparison.
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/LayoutTestController.cpp:
        (setTabKeyCyclesThroughElementsCallback): Implemented.

2007-03-20  Adam Roben  <aroben@apple.com>

        Reviewed by Oliver.

        Implemented layoutTestController.clearBackForwardList() to fix
        fast/dom/location-hash.html.

        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/LayoutTestController.cpp:
        (clearBackForwardListCallback): Implemented.

2007-03-20  Adam Roben  <aroben@apple.com>

        Reviewed by Oliver.

        Remove Arial fonts because of <rdar://problem/5074441>.

        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/DumpRenderTree.cpp:
        (initialize): Don't install Arial.
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/Resources/Arial Bold Italic.ttf: Removed.
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/Resources/Arial Bold.ttf: Removed.
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/Resources/Arial Italic.ttf: Removed.
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/Resources/Arial.ttf: Removed.

2007-03-19  Adam Roben  <aroben@apple.com>

        Reviewed by Ada.

        Made DRT output UTF8 strings.

        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/DumpRenderTree.cpp:
        (dump): Convert to UTF8 before printing.

2007-03-19  Adam Roben  <aroben@apple.com>

        Reviewed by Geoff.

        Added support for --threaded.

        Note that this always crashes right now due to
        <rdar://problem/5051141> JavaScriptCore is not thread-safe,
        but that's why we need this feature!

        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/DumpRenderTree.cpp:
        (initialize): Changed NULL to 0.
        (runTest): Ditto.
        (pthread_equal): Added.
        (javaScriptThreads): Ported from Mac.
        (runJavaScriptThread): Ditto.
        (startJavaScriptThreads): Ditto.
        (stopJavaScriptThreads): Ditto.
        (main): Parse --threaded argument and start/stop threads if needed.
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/DumpRenderTree.vcproj:
        Link against pthreadVC2.lib, and added include/pthreads to the include
        path.

2007-03-19  Adam Roben  <aroben@apple.com>

        Reviewed by Anders and Darin.

        Fix <rdar://problem/5071653> DumpRenderTree needs to be able to
        trigger GC on a separate thread

        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/DumpRenderTree.vcproj:
        Added GCController.(cpp|h) to the project.
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/GCController.cpp: Added.
        (collectCallback):
        (collectOnAlternateThreadCallback):
        (getJSObjectCountCallback):
        (getClass):
        (makeGCController):
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/GCController.h: Added.
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/WaitUntilDoneDelegate.cpp:
        (WaitUntilDoneDelegate::windowScriptObjectAvailable): Add the
        GCController to the window object.

2007-03-19  Adam Roben  <aroben@apple.com>

        Release build fix.

        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/DumpRenderTree.vcproj:
        Set the include path for release to the same as for debug.

2007-03-19  Adam Roben  <aroben@apple.com>

        Reviewed by Adele.

        Fix eventSender.keyDown() to create WM_CHAR messages as well, since these
        are needed by WebCore.

        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/EventSender.cpp:
        (dispatchMessage): Added.
        (mouseDownCallback): Call dispatchMessage instead of DispatchMessage.
        (doMouseUp): Ditto.
        (mouseClickCallback): Ditto.
        (doMouseMove): Ditto.
        (keyDownCallback): Ditto.

2007-03-19  Adam Roben  <aroben@apple.com>

        Reviewed by Hyatt.

        Implemented some more layoutTestController methods:
        - display
        - testRepaint
        - repaintSweepHorizontally

        The last two don't have any effect yet because we don't support pixel
        tests yet (<rdar://problem/5071708>).

        This gets all but one test in fast/repaint passing, and fixes various
        other tests that use these methods as well.

        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/DumpRenderTree.cpp:
        (runTest): Initialize new globals.
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/DumpRenderTree.h:
        Added extern declarations.
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/LayoutTestController.cpp:
        (displayCallback): Implemented.
        (testRepaintCallback): Implemented.
        (repaintSweepHorizontallyCallback): Implemented.

2007-03-18  Adam Roben  <aroben@apple.com>

        Reviewed by Hyatt.

        Fix DRT part of <rdar://problem/5066482> DumpRenderTree on Windows
        doesn't dump editing callbacks

        However, we still don't dump anything because of
        <rdar://problem/5071598>.

        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/DumpRenderTree.cpp:
        (runTest): Initialize shouldDumpEditingCallbacks.
        (main): Set the WebView's editing delegate.
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/DumpRenderTree.h:
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/DumpRenderTree.vcproj:
        Added EditingDelegate.(cpp|h) to the project.
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/EditingDelegate.cpp: Added.
        (EditingDelegate::EditingDelegate):
        (EditingDelegate::QueryInterface):
        (EditingDelegate::AddRef):
        (EditingDelegate::Release):
        (dumpPath):
        (dump):
        (EditingDelegate::shouldBeginEditingInDOMRange):
        (EditingDelegate::shouldEndEditingInDOMRange):
        (EditingDelegate::shouldInsertNode):
        (EditingDelegate::shouldInsertText):
        (EditingDelegate::shouldDeleteDOMRange):
        (EditingDelegate::shouldChangeSelectedDOMRange):
        (EditingDelegate::shouldApplyStyle):
        (EditingDelegate::shouldChangeTypingStyle):
        (EditingDelegate::doPlatformCommand):
        (EditingDelegate::webViewDidBeginEditing):
        (EditingDelegate::webViewDidChange):
        (EditingDelegate::webViewDidEndEditing):
        (EditingDelegate::webViewDidChangeTypingStyle):
        (EditingDelegate::webViewDidChangeSelection):
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/EditingDelegate.h: Added.
        (EditingDelegate::setAcceptsEditing):
        (EditingDelegate::undoManagerForWebView):
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/LayoutTestController.cpp:
        (dumpEditingCallbacksCallback): Ported from Mac.
        (setAcceptsEditingCallback): Ditto.

2007-03-18  Adam Roben  <aroben@apple.com>

        Reviewed by Geoff.

        Added a basic implementation of eventSender. It supports mouse and key
        events.

        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/DraggingInfo.h: Added.
        (DraggingInfo::DraggingInfo):
        (DraggingInfo::~DraggingInfo):
        (DraggingInfo::dataObject):
        (DraggingInfo::dropSource):
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/DumpRenderTree.cpp:
        (main): Made the WebView's HWND a global so that EventSender can
        access it.
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/DumpRenderTree.h:
        Added extern declarations.
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/DumpRenderTree.vcproj:
        Added new files to project.
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/EventSender.cpp: Added.
        (getDragModeCallback):
        (setDragModeCallback):
        (leapForwardCallback):
        (currentEventTime):
        (makeMsg):
        (mouseDownCallback):
        (pointl):
        (doMouseUp):
        (mouseUpCallback):
        (mouseClickCallback):
        (doMouseMove):
        (mouseMoveToCallback):
        (replaySavedEvents):
        (keyDownCallback):
        (getClass):
        (makeEventSender):
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/EventSender.h: Added.
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/LayoutTestController.cpp:
        Re-ordered #includes.
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/LayoutTestController.h:
        Changed #include to forward declarations.
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/WaitUntilDoneDelegate.cpp:
        (WaitUntilDoneDelegate::windowScriptObjectAvailable): Make the
        eventSender available.
        (WaitUntilDoneDelegate::doDragDrop): Implemented.
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/WaitUntilDoneDelegate.h:

2007-03-17  Adam Roben  <aroben@apple.com>

        Reviewed by Hyatt.

        Implemented console message dumping.

        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/WaitUntilDoneDelegate.cpp:
        (WaitUntilDoneDelegate::QueryInterface): Added cases for IWebUIDelegate[Private]
        (WaitUntilDoneDelegate::webViewAddMessageToConsole): Implemented.
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/WaitUntilDoneDelegate.h:
        Now inherits from IWebUIDelegatePrivate

2007-03-15  Adam Roben  <aroben@apple.com>

        Reviewed by Ada.

        Second part of two-step dance to rename AHEM____.TTF to AHEM____.ttf.

        This is to work around <rdar://problem/5063416>.

        Also made all the ttf files in DumpRenderTree/Resources executable again to appease Windows.

        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/DumpRenderTree.cpp:
        (initialize):
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/Resources/AHEM____.ttf: Added.
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/Resources/renameMe.ttf: Removed.

2007-03-15  Adam Roben  <aroben@apple.com>

        Reviewed by Ada.

        First part of a two-step dance to rename AHEM____.TTF to AHEM____.ttf.

        First, rename AHEM____.TTF to renameMe.ttf.

        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/DumpRenderTree.cpp:
        (initialize):
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/Resources/AHEM____.TTF: Removed.
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/Resources/renameMe.ttf: Added.

2007-03-14  Adam Roben  <aroben@apple.com>

        Rubberstamped by Anders.

        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/DumpRenderTree.cpp:
        (runTest): Initialize done to false just like Mac does.

2007-03-14  Adam Roben  <aroben@apple.com>

        Fixed line-endings and svn properties on DRT files.

2007-03-14  Adam Roben  <aroben@apple.com>

        Reviewed by Anders.

        Make DRT on Windows behave more like DRT on Mac with respect to
        waitUntilDone()/waitUntilDone().

        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/DumpRenderTree.cpp:
        Added "done" and "topLoadingFrame" globals to match Mac, removed readyToDump.
        (dump): Set done to true.
        (runTest): Removed readyToDump, initialized topLoadingFrame.
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/DumpRenderTree.h:
        Added extern declarations for globals.
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/LayoutTestController.cpp:
        (notifyDoneCallback): Changed condition to match Mac.
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/WaitUntilDoneDelegate.cpp:
        (WaitUntilDoneDelegate::didStartProvisionalLoadForFrame): Set topLoadingFrame.
        (WaitUntilDoneDelegate::locationChangeDone): Ported from Mac.
        (WaitUntilDoneDelegate::didFinishLoadForFrame): Call locationChangeDone.
        (WaitUntilDoneDelegate::didFailLoadWithError): Ditto.
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/WaitUntilDoneDelegate.h:
        Moved implementation of didFailLoadWithError to .cpp file.

2007-03-14  Adam Roben  <aroben@apple.com>

        Reviewed by Anders.

        Use Mac fonts when running regression tests to match Mac's metrics.

        This makes many layout tests pass when run against results generated on the Mac.

        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/DumpRenderTree.cpp:
        Turned on Mac fonts.
        (initialize): Install our Mac fonts into GDI programmatically at runtime.
        (dump): Match Mac's handling of newlines when printing.
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/DumpRenderTree.h:
        Added WINVER define to get access to AddFontResourceEx.
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/DumpRenderTree.vcproj:
        Added post-build step to copy fonts to WebKitOutputDir/DumpRenderThree.resources.
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/WaitUntilDoneDelegate.cpp:
        * Re-ordered #includes.
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/WaitUntilDoneDelegate.h:
        Moved #includes within header guard.
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/Resources/AHEM____.TTF: Added.
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/Resources/Apple Chancery.ttf: Added.
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/Resources/Arial Bold.ttf: Added.
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/Resources/Arial Bold Italic.ttf: Added.
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/Resources/Arial Italic.ttf: Added.
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/Resources/Arial.ttf: Added.
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/Resources/Courier Bold.ttf: Added.
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/Resources/Courier.ttf: Added.
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/Resources/Helvetica Bold.ttf: Added.
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/Resources/Helvetica.ttf: Added.
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/Resources/Lucida Grande Bold.ttf: Added.
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/Resources/Lucida Grande.ttf: Added.
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/Resources/Monaco.ttf: Added.
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/Resources/Papyrus.ttf: Added.
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/Resources/Times Bold Italic.ttf: Added.
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/Resources/Times Bold.ttf: Added.
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/Resources/Times Italic.ttf: Added.
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/Resources/Times Roman.ttf: Added.

2007-03-12  Adam Roben  <aroben@apple.com>

        Reviewed by Darin.

        Get DRT to size the WebView correctly, and added font family prefs.

        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/DumpRenderTree.cpp:
        (initialize): Make the DRT window an off-screen tool window so it isn't
        visible to the user despite having been "shown".
        (initializePreferences): Set font preferences.
        (main): Initially size the WebView to 0x0, then do a SetWindowPos to
        the desired size (this is what Boomer does).

2007-03-09  Anders Carlsson  <acarlsson@apple.com>

        Reviewed by Adam.

        Fix build and do some general cleanup.
        
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/WaitUntilDoneDelegate.h:
        (WaitUntilDoneDelegate::didReceiveServerRedirectForProvisionalLoadForFrame):
        (WaitUntilDoneDelegate::didFailProvisionalLoadWithError):
        (WaitUntilDoneDelegate::didCommitLoadForFrame):
        (WaitUntilDoneDelegate::didReceiveIcon):
        (WaitUntilDoneDelegate::didFailLoadWithError):
        (WaitUntilDoneDelegate::didChangeLocationWithinPageForFrame):
        (WaitUntilDoneDelegate::willPerformClientRedirectToURL):
        (WaitUntilDoneDelegate::didCancelClientRedirectForFrame):
        (WaitUntilDoneDelegate::willCloseFrame):
        (WaitUntilDoneDelegate::createWebViewWithRequest):
        (WaitUntilDoneDelegate::webViewShow):
        (WaitUntilDoneDelegate::webViewClose):
        (WaitUntilDoneDelegate::webViewFocus):
        (WaitUntilDoneDelegate::webViewUnfocus):
        (WaitUntilDoneDelegate::webViewFirstResponder):
        (WaitUntilDoneDelegate::makeFirstResponder):
        (WaitUntilDoneDelegate::setStatusText):
        (WaitUntilDoneDelegate::webViewStatusText):
        (WaitUntilDoneDelegate::webViewAreToolbarsVisible):
        (WaitUntilDoneDelegate::setToolbarsVisible):
        (WaitUntilDoneDelegate::webViewIsStatusBarVisible):
        (WaitUntilDoneDelegate::setStatusBarVisible):
        (WaitUntilDoneDelegate::webViewIsResizable):
        (WaitUntilDoneDelegate::setResizable):
        (WaitUntilDoneDelegate::setFrame):
        (WaitUntilDoneDelegate::webViewFrame):
        (WaitUntilDoneDelegate::setContentRect):
        (WaitUntilDoneDelegate::webViewContentRect):
        (WaitUntilDoneDelegate::runJavaScriptConfirmPanelWithMessage):
        (WaitUntilDoneDelegate::runJavaScriptTextInputPanelWithPrompt):
        (WaitUntilDoneDelegate::runBeforeUnloadConfirmPanelWithMessage):
        (WaitUntilDoneDelegate::runOpenPanelForFileButtonWithResultListener):
        (WaitUntilDoneDelegate::mouseDidMoveOverElement):
        (WaitUntilDoneDelegate::contextMenuItemsForElement):
        (WaitUntilDoneDelegate::validateUserInterfaceItem):
        (WaitUntilDoneDelegate::shouldPerformAction):
        (WaitUntilDoneDelegate::dragDestinationActionMaskForDraggingInfo):
        (WaitUntilDoneDelegate::willPerformDragDestinationAction):
        (WaitUntilDoneDelegate::dragSourceActionMaskForPoint):
        (WaitUntilDoneDelegate::willPerformDragSourceAction):
        (WaitUntilDoneDelegate::contextMenuItemSelected):
        (WaitUntilDoneDelegate::trackCustomPopupMenu):
        (WaitUntilDoneDelegate::measureCustomMenuItem):
        (WaitUntilDoneDelegate::drawCustomMenuItem):
        (WaitUntilDoneDelegate::cleanUpCustomMenuDrawingData):
        (WaitUntilDoneDelegate::canTakeFocus):
        (WaitUntilDoneDelegate::takeFocus):
        (WaitUntilDoneDelegate::registerUndoWithTarget):
        (WaitUntilDoneDelegate::removeAllActionsWithTarget):
        (WaitUntilDoneDelegate::setActionTitle):
        (WaitUntilDoneDelegate::undo):
        (WaitUntilDoneDelegate::redo):
        (WaitUntilDoneDelegate::canUndo):
        (WaitUntilDoneDelegate::canRedo):
        (WaitUntilDoneDelegate::addCustomMenuDrawingData):

2007-01-29  Anders Carlsson  <acarlsson@apple.com>

        Reviewed by Darin and Geoff.

        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/DumpRenderTree.cpp:
        (initialize):
        Call OleInitialize.
        
        (runTest):
        Use CF for creating the URLs passed in.
        
        (initializePreferences):
        Don't autosave the preferences.
        
        (main):
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/DumpRenderTree.vcproj:
        Link with CF.

2007-01-29  Anders Carlsson  <acarlsson@apple.com>

        Build fix.
        
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/WaitUntilDoneDelegate.h:
        (WaitUntilDoneDelegate::dragDestinationActionMaskForDraggingInfo):
        (WaitUntilDoneDelegate::willPerformDragDestinationAction):

2007-01-18  Anders Carlsson  <acarlsson@apple.com>

        Reviewed by Adam.

        Major cleanups and bugfixes, such as:
        
        Update for changes to the API.
        Implement a timer which prevents test from hanging indefinitely.
        Fix bugs which would cause the same test result to be dumped twice.
        
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/DumpRenderTree.cpp:
        (DumpRenderTreeWndProc):
        Handle timer.
        
        (initialize):
        Initialize CoreGraphics so we get fonts.
        (runTest):
        Add timer.
        
        (initializePreferences):
        Turn off Java and Plug-ins.
        
        (main):
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/DumpRenderTree.h:
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/DumpRenderTree.vcproj:
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/LayoutTestController.cpp:
        (waitUntilDoneCallback):
        (notifyDoneCallback):
        Fix bug where dump could be called twice.
        
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/WaitUntilDoneDelegate.cpp:
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/WaitUntilDoneDelegate.h:
        Fix newlines, update for new API.

2006-11-07  Anders Carlsson  <acarlsson@apple.com>

        Reviewed by Geoff.
        
        Fix the build. Hook up a layoutTestController and implement dumpAsText, waitUntilDone and notifyDone.

        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/DumpRenderTree.cpp:
        (dump):
        (main):
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/DumpRenderTree.h: Added.
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/DumpRenderTree.vcproj:
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/LayoutTestController.cpp: Added.
        (dumpAsTextCallback):
        (waitUntilDoneCallback):
        (notifyDoneCallback):
        (getClass):
        (createLayoutTestController):
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/LayoutTestController.h: Added.
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/WaitUntilDoneDelegate.cpp:
        (WaitUntilDoneDelegate::didFinishLoadForFrame):
        (WaitUntilDoneDelegate::windowScriptObjectAvailable):
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/WaitUntilDoneDelegate.h:
        (WaitUntilDoneDelegate::didReceiveServerRedirectForProvisionalLoadForFrame):
        (WaitUntilDoneDelegate::didFailProvisionalLoadWithError):
        (WaitUntilDoneDelegate::didCommitLoadForFrame):
        (WaitUntilDoneDelegate::didReceiveIcon):
        (WaitUntilDoneDelegate::didFailLoadWithError):
        (WaitUntilDoneDelegate::didChangeLocationWithinPageForFrame):
        (WaitUntilDoneDelegate::willPerformClientRedirectToURL):
        (WaitUntilDoneDelegate::didCancelClientRedirectForFrame):
        (WaitUntilDoneDelegate::willCloseFrame):
        (WaitUntilDoneDelegate::createWebViewWithRequest):
        (WaitUntilDoneDelegate::webViewShow):
        (WaitUntilDoneDelegate::webViewClose):
        (WaitUntilDoneDelegate::webViewFocus):
        (WaitUntilDoneDelegate::webViewUnfocus):
        (WaitUntilDoneDelegate::webViewFirstResponder):
        (WaitUntilDoneDelegate::makeFirstResponder):
        (WaitUntilDoneDelegate::setStatusText):
        (WaitUntilDoneDelegate::webViewStatusText):
        (WaitUntilDoneDelegate::webViewAreToolbarsVisible):
        (WaitUntilDoneDelegate::setToolbarsVisible):
        (WaitUntilDoneDelegate::webViewIsStatusBarVisible):
        (WaitUntilDoneDelegate::setStatusBarVisible):
        (WaitUntilDoneDelegate::webViewIsResizable):
        (WaitUntilDoneDelegate::setResizable):
        (WaitUntilDoneDelegate::setFrame):
        (WaitUntilDoneDelegate::webViewFrame):
        (WaitUntilDoneDelegate::setContentRect):
        (WaitUntilDoneDelegate::webViewContentRect):
        (WaitUntilDoneDelegate::runJavaScriptConfirmPanelWithMessage):
        (WaitUntilDoneDelegate::runJavaScriptTextInputPanelWithPrompt):
        (WaitUntilDoneDelegate::runOpenPanelForFileButtonWithResultListener):
        (WaitUntilDoneDelegate::mouseDidMoveOverElement):
        (WaitUntilDoneDelegate::contextMenuItemsForElement):
        (WaitUntilDoneDelegate::validateUserInterfaceItem):
        (WaitUntilDoneDelegate::shouldPerformAction):
        (WaitUntilDoneDelegate::dragDestinationActionMaskForDraggingInfo):
        (WaitUntilDoneDelegate::willPerformDragDestinationAction):
        (WaitUntilDoneDelegate::dragSourceActionMaskForPoint):
        (WaitUntilDoneDelegate::willPerformDragSourceAction):

2006-10-06  Anders Carlsson  <acarlsson@apple.com>

        Reviewed by Maciej.

        Land new version of DumpRenderTree that uses the WebKit APIs.
        
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/DumpRenderTree.cpp:
        (initialize):
        (dump):
        (runTest):
        (main):
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/DumpRenderTree.vcproj:
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/WaitUntilDoneDelegate.cpp: Added.
        (WaitUntilDoneDelegate::QueryInterface):
        (WaitUntilDoneDelegate::AddRef):
        (WaitUntilDoneDelegate::Release):
        (WaitUntilDoneDelegate::didStartProvisionalLoadForFrame):
        (WaitUntilDoneDelegate::didReceiveTitle):
        (WaitUntilDoneDelegate::didFinishLoadForFrame):
        (WaitUntilDoneDelegate::runJavaScriptAlertPanelWithMessage):
        (WaitUntilDoneDelegate::windowScriptObjectAvailable):
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/WaitUntilDoneDelegate.h: Added.
        (WaitUntilDoneDelegate::WaitUntilDoneDelegate):
        (WaitUntilDoneDelegate::didReceiveServerRedirectForProvisionalLoadForFrame):
        (WaitUntilDoneDelegate::didFailProvisionalLoadWithError):
        (WaitUntilDoneDelegate::didCommitLoadForFrame):
        (WaitUntilDoneDelegate::didReceiveIcon):
        (WaitUntilDoneDelegate::didFailLoadWithError):
        (WaitUntilDoneDelegate::didChangeLocationWithinPageForFrame):
        (WaitUntilDoneDelegate::willPerformClientRedirectToURL):
        (WaitUntilDoneDelegate::didCancelClientRedirectForFrame):
        (WaitUntilDoneDelegate::willCloseFrame):
        (WaitUntilDoneDelegate::createWebViewWithRequest):
        (WaitUntilDoneDelegate::webViewShow):
        (WaitUntilDoneDelegate::webViewClose):
        (WaitUntilDoneDelegate::webViewFocus):
        (WaitUntilDoneDelegate::webViewUnfocus):
        (WaitUntilDoneDelegate::webViewFirstResponder):
        (WaitUntilDoneDelegate::makeFirstResponder):
        (WaitUntilDoneDelegate::setStatusText):
        (WaitUntilDoneDelegate::webViewStatusText):
        (WaitUntilDoneDelegate::webViewAreToolbarsVisible):
        (WaitUntilDoneDelegate::setToolbarsVisible):
        (WaitUntilDoneDelegate::webViewIsStatusBarVisible):
        (WaitUntilDoneDelegate::setStatusBarVisible):
        (WaitUntilDoneDelegate::webViewIsResizable):
        (WaitUntilDoneDelegate::setResizable):
        (WaitUntilDoneDelegate::setFrame):
        (WaitUntilDoneDelegate::webViewFrame):
        (WaitUntilDoneDelegate::setContentRect):
        (WaitUntilDoneDelegate::webViewContentRect):
        (WaitUntilDoneDelegate::runJavaScriptConfirmPanelWithMessage):
        (WaitUntilDoneDelegate::runJavaScriptTextInputPanelWithPrompt):
        (WaitUntilDoneDelegate::runOpenPanelForFileButtonWithResultListener):
        (WaitUntilDoneDelegate::mouseDidMoveOverElement):
        (WaitUntilDoneDelegate::contextMenuItemsForElement):
        (WaitUntilDoneDelegate::validateUserInterfaceItem):
        (WaitUntilDoneDelegate::shouldPerformAction):
        (WaitUntilDoneDelegate::dragDestinationActionMaskForDraggingInfo):
        (WaitUntilDoneDelegate::willPerformDragDestinationAction):
        (WaitUntilDoneDelegate::dragSourceActionMaskForPoint):
        (WaitUntilDoneDelegate::willPerformDragSourceAction):
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/debug.vsprops: Added.
        * DumpRenderTree/DumpRenderTree.vcproj/DumpRenderTree/release.vsprops: Added.

